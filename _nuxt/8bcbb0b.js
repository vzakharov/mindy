(window.webpackJsonp=window.webpackJsonp||[]).push([[8,2,3,6],{392:function(e,t,n){"use strict";var r,o=n(0);r=function(e){return e},t.a=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=n.deep,l=n.save,d=void 0===l?r:l,f=n.load,m=void 0===f?r:f;return{data:function(){return Object(o.a)({},e,null)},watch:(t={},Object(o.a)(t,e,{deep:c,handler:function(e){return this.$emit("input",d.call(this,e))}}),Object(o.a)(t,"value",{deep:c,immediate:!0,handler:function(t){return this[e]=m.call(this,t)}}),t)}}},395:function(e,t,n){"use strict";n.r(t);var r,o=n(40),c=(n(247),n(15),n(19),n(1),n(37),n(4),n(62),n(10),n(30),n(22),n(392));r=function(e){return"number"===this.inputProps.type?Number(e):e};var l={mixins:[Object(c.a)("setting",{save:r,load:r})],props:{value:{required:!0},properties:{type:Object,default:function(){return{}}}},computed:{id:function(){return"edit-settings-input-".concat(this.$vnode.key,"-").concat(Math.random().toString(36).slice(2))},label:function(){return this.properties.label||this.$vnode.key},description:function(){var e;return e=this.properties.description,(null!=e?e[!0]:void 0)&&e[!1]?e[this.setting]:e},inputTagAndProps:function(){var e,t,n=this;if(t={multiline:function(){var e;return{tag:"b-textarea",props:{rows:Math.max(10,Math.min(20,null!=(e=n.value)?e.split("\n").length:void 0)),style:n.properties.monospace?"font-family: monospace; tab-size: 2; -moz-tab-size: 2;":"",placeholder:n.properties.placeholder||"Enter text here"}}},text:{tag:"b-input",props:{type:"text",placeholder:this.properties.placeholder||"Enter text here"}},number:{tag:"b-input",props:{type:"number",placeholder:this.properties.placeholder||"Enter a number here"}},boolean:{tag:"b-checkbox",props:{switch:!0}}},this.properties.type)return("function"==typeof(e=t[this.properties.type])?e():void 0)||e;switch(Object(o.a)(this.value)){case"number":return t.number;case"boolean":return t.boolean;default:return t.text}},inputTag:function(){return this.inputTagAndProps.tag},inputProps:function(){return this.inputTagAndProps.props}},methods:{onTab:function(e){var t,n,r,o,c,l,d=this;if(this.properties.monospace){var f=this.$refs.input.$el;return o=f.selectionStart,r=f.selectionEnd,l=this.value.substring(0,o),n=this.value.substring(o,r),c=this.value.substring(r),t=l.lastIndexOf("\n")||0,n=l.substring(t+1,o)+n,l=l.substring(0,t+1),n=n.replace(/(\n|^)(\t?)/g,e.shiftKey?"$1":"$1$2\t"),this.setting=l+n+c,e.preventDefault(),this.$nextTick((function(){return d.$refs.input.$el.setSelectionRange(o+(e.shiftKey?-1:1),r+(e.shiftKey?-1:1))}))}}}},d=n(68),component=Object(d.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-form-group",e._b({attrs:{"label-for":e.id}},"b-form-group",{label:e.label,description:e.description},!1),[n(e.inputTag,e._b({ref:"input",tag:"component",attrs:{id:e.id},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"tab",9,t.key,"Tab")?null:e.onTab.apply(null,arguments)}},model:{value:e.setting,callback:function(t){e.setting=t},expression:"setting"}},"component",e.inputProps,!1))],1)}),[],!1,null,null,null);t.default=component.exports},397:function(e,t,n){"use strict";var r,o,c=n(33);r=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.args,r=t.callback,o=t.logOrDebug,l=void 0===o?"debug":o;return(e=console)[l].apply(e,Object(c.a)(n)),"function"==typeof r&&r(),n[n.length-1]},o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r({args:t})},o.breakpoint=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r({args:t,callback:function(){}})},o.always=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r({args:t,logOrDebug:"log"})},t.a=o},398:function(e,t,n){var content=n(405);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(109).default)("4b75e02a",content,!0,{sourceMap:!1})},399:function(e,t,n){"use strict";n.r(t);var r=n(392),o={mixins:[Object(r.a)("settings",{deep:!0})],props:{title:{type:String,default:"Edit settings"},okTitle:{type:String,default:"Save"},cancelTitle:{type:String,default:"Cancel"},value:{type:Object,required:!0},properties:{type:Object,default:function(){return{}}}}},c=n(68),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-form",{staticStyle:{width:"100%"}},e._l(e.settings,(function(t,r){return n("EditSettingsInput",{key:r,attrs:{properties:e.properties[r]},model:{value:e.settings[r],callback:function(t){e.$set(e.settings,r,t)},expression:"settings[key]"}})})),1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{EditSettingsInput:n(395).default})},401:function(e,t,n){"use strict";var r,o=n(34);n(84),n(1),n(15);t.a={data:function(){return{actionPromises:{}}},methods:{actionPromise:function(e){var t;return null!=(t=this.actionPromises[e])?t:Promise.resolve()},try:(r=Object(o.a)(regeneratorRuntime.mark((function e(t,n){var r,o,c,l,d,f,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=m.length>2&&void 0!==m[2]?m[2]:{},o=r.errorMessage,c=r.except,this[t]=!0,f=null,d=null,this.actionPromises[t]=new Promise((function(e,t){return f=e,d=t})),e.prev=5,console.log("Started ".concat(t)),e.t0=f,e.next=10,n();case 10:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 14:return e.prev=14,e.t2=e.catch(5),l=e.t2,console.error("Error while ".concat(t,": ").concat(l)),"function"==typeof o&&(o=o(l)),this.alert(o),"function"==typeof c&&c(l),e.abrupt("return",d(l));case 22:return e.prev=22,this[t]=!1,console.log("Finished ".concat(t)),e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[5,14,22,26]])}))),function(e,t){return r.apply(this,arguments)}),alert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Something went wrong.";return this.$bvToast.toast("See console for error details.",{title:e,variant:"danger",solid:!0,autoHideDelay:5e3})}}}},404:function(e,t,n){"use strict";n(398)},405:function(e,t,n){var r=n(108)(!1);r.push([e.i,".code[data-v-9abc86a4]{font-family:monospace;background-color:#1e1e1e;color:#d4d4d4;height:calc(100% - 2.5rem)}",""]),e.exports=r},411:function(e,t,n){var content=n(440);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(109).default)("1b7833da",content,!0,{sourceMap:!1})},413:function(e,t,n){"use strict";n.r(t);n(171);var r,o,c=n(34),l=n(29),d=n(28),f=n(67),m=n(126),h=n(49),v=n(166),y=(n(84),n(400),n(10),n(22),n(1),n(30),n(397),{data:function(){var e;return e={state:!1},Object.assign(e,{promise:new Promise((function(t){return Object.assign(e,{resolve:t})}))}),{mounted:e}},mounted:function(){return this.mounted.resolve(),this.mounted.state=!0}});function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}r=function(e){Object(f.a)(n,e);var t=x(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n)}(Object(v.a)(Error)),o=function(line){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return(line.length-line.trimLeft().length)/e};var k,w={mixins:[y],props:["value"],data:function(){return{chartRendered:!1,editInPlainText:!1}},computed:{context:{get:function(){return this.value},set:function(e){return this.$emit("input",e)}},isValid:function(){var e;try{return this.validate(this.context),!0}catch(t){return e=t,console.error(e),!1}},mermaidString:function(){var e;try{this.validate(this.context)}catch(e){return e,""}return e="mindmap\n"+this.context.replace(/[~@\-~"()]/g,(function(e){return"#".concat(e.charCodeAt(0),";")})),console.log(e),e}},mounted:function(){var script;return console.log("MindyContext mounted"),document.getElementById("mermaid-init")?console.log("mermaid-init script already exists"):(console.log("creating mermaid-init script"),(script=document.createElement("script")).id="mermaid-init",script.type="module",window.mermaidLoaded={state:!1,resolve:null},window.mermaidLoaded.promise=new Promise((function(e){return Object.assign(window.mermaidLoaded,{resolve:e})})),script.innerHTML="let resolve = null\nimport mermaid from 'https://unpkg.com/mermaid@9/dist/mermaid.esm.mjs';\nconsole.log({mermaid})\nimport mindmap from 'https://unpkg.com/@mermaid-js/mermaid-mindmap@9/dist/mermaid-mindmap.esm.mjs';\nconsole.log({mindmap})\nawait mermaid.registerExternalDiagrams([mindmap]);\nmermaid.startOnLoad = false;\nObject.assign(window, {mermaid, mindmap});\nconsole.log('mermaid loaded')\nwindow.mermaidLoaded.state = true\nwindow.mermaidLoaded.resolve()",document.head.appendChild(script),console.log(script))},watch:{mermaidString:{immediate:!0,handler:(k=Object(c.a)(regeneratorRuntime.mark((function e(t){var element,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.chartRendered=!1,console.log("Creating mermaid chart for",t),this.mounted.state){e.next=7;break}return console.log("Waiting for the component to be mounted"),e.next=6,this.mounted.promise;case 6:console.log("Component mounted");case 7:if(window.mermaidLoaded.state){e.next=12;break}return console.log("Waiting for mermaid to be loaded"),e.next=11,window.mermaidLoaded.promise;case 11:console.log("Mermaid loaded");case 12:return element=document.getElementById("mermaid-container"),e.abrupt("return",this.$nextTick((function(){return console.log("Updating mermaid chart"),mermaid.renderAsync("mermaid-".concat(Date.now()),t,(function(svg){return element.innerHTML=svg,n.chartRendered=!0,console.log("Mermaid chart updated")}))})));case 14:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})}},methods:{helloWorld:function(){return console.log("Hello world")},validate:function(e){var i,t,n,c,l;if(!e)throw new r("Context is empty");if(n=e.split("\n"),0!==o(n[0]))throw new r("The first line must not be indented");if(0===o(n[1]))throw new r("The second line must be indented");for(l=o(n[1],1),i=t=2,c=n.length;2<=c?t<c:t>c;i=2<=c?++t:--t){if(o(n[i],l)>o(n[i-1],l)+1)throw new r("Line ".concat(i+1," is indented by more than one level more than the previous line"));if(o(n[i],l)<1)throw new r("Line ".concat(i+1," is not indented; only one root topic is allowed"))}return!0}}},O=w,C=(n(404),n(68)),component=Object(C.a)(O,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-col",[n("b-row",{staticClass:"justify-content-center",attrs:{id:"mermaid-container"}}),e.isValid?e._e():n("b-alert",{staticClass:"text-left mt-3",attrs:{variant:"danger",show:""}},[n("strong",[e._v("Cannot render the mind map; please edit the context below:")]),n("ul",[n("li",[e._v("Exactly one line with no tabs in the beginning")]),n("li",[e._v("Every next line indented by the same, fewer, or just one more tab than the previous line")])])]),n("b-button",{staticClass:"btn-sm btn-light m-1",attrs:{variant:e.isValid?e.editInPlainText?"outline-success":"light":"outline-danger"},on:{click:function(t){e.editInPlainText=!e.editInPlainText}}},[e._v("🖉")]),n("b-button",{staticClass:"btn-sm btn-light m-1",on:{click:function(t){return e.$emit("rebuild")}}},[e._v("↺")]),n("b-row",{directives:[{name:"show",rawName:"v-show",value:e.editInPlainText||!e.isValid,expression:"editInPlainText || !isValid"}],style:e.isValid?"":"border: 1px solid red; border-radius: 5px; padding: 10px;"},[n("EditSettings",{attrs:{title:"Edit context in plain text",value:{context:e.context},properties:{context:{type:"multiline",monospace:!0,label:"Mind map tree",placeholder:"Main topic\n\tSub-topic\n\t\tSub-sub-topic\n\tAnother sub-topic",description:"Tab/Shift-Tab to indent/unindent lines."}}},on:{input:function(t){e.context=t.context}}})],1)],1)}),[],!1,null,"9abc86a4",null);t.default=component.exports;installComponents(component,{EditSettings:n(399).default})},414:function(e,t,n){"use strict";n.r(t);var r=n(34),o=(n(84),n(105)),c=n.n(o),l={mixins:[n(401).a],props:["value"],data:function(){return console.log("OpenAIKeyModal value: ".concat(this.value)),{openAIkey:this.value,checkingKey:!1,keyValid:!!this.value}},methods:{show:function(){return this.$refs.openAIKeyModal.show()},hide:function(){return this.$refs.openAIKeyModal.hide()},checkKey:function(){var e=this;return this.try("checkingKey",Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Checking key ".concat(e.openAIkey)),t.next=3,c.a.post("https://api.openai.com/v1/engines/text-ada-001/completions",{prompt:"Hello",max_tokens:1},{headers:{Authorization:"Bearer ".concat(e.openAIkey)}});case 3:return e.$bvToast.toast("Yay, the key is valid! Enjoy the app!",{title:"Success",variant:"success",autoHideDelay:3e3}),e.keyValid=!0,e.$emit("input",e.openAIkey),t.abrupt("return",e.hide());case 7:case"end":return t.stop()}}),t)}))),{errorMessage:function(e){var t;return 401===(null!=e&&null!=(t=e.response)?t.status:void 0)&&"Invalid API key"}})}}},d=n(68),component=Object(d.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-modal",{ref:"openAIKeyModal",attrs:{title:"Enter your OpenAI API key","hide-footer":"","no-close-on-backdrop":!e.openAIkey||!e.keyValid,"no-close-on-esc":!e.openAIkey||!e.keyValid,"hide-header-close":!e.openAIkey||!e.keyValid}},[n("h4",[e._v("Why?")]),n("p",[e._v("This app uses the OpenAI API to generate texts.\nWe DO NOT store your API key anywhere on our servers.\nYou can get your own API key "),n("a",{attrs:{href:"https://beta.openai.com/account/api-keys",target:"_blank"}},[e._v("here")]),e._v(".")]),n("b-form",{on:{submit:function(t){return t.preventDefault(),e.checkKey()}}},[n("b-form-group",{attrs:{label:"OpenAI API key","label-for":"openAIkey"}},[n("b-form-input",{attrs:{id:"openAIkey",type:"text",placeholder:"sk-...",disabled:e.checkingKey},model:{value:e.openAIkey,callback:function(t){e.openAIkey=t},expression:"openAIkey"}})],1),n("b-button",{attrs:{type:"submit",variant:"primary",disabled:!e.openAIkey||e.checkingKey}},[n("b-spinner",{directives:[{name:"show",rawName:"v-show",value:e.checkingKey,expression:"checkingKey"}],attrs:{small:"",type:"grow"}}),e._v(e._s(e.checkingKey?"Checking...":"Check and save"))],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports},438:function(e,t,n){"use strict";(function(e){n(5),n(4),n(2),n(1),n(6),n(3),n(7);var r=n(0),o=n(105),c=n.n(o);function l(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function d(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}t.a=function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.polygonAPIurl,o=void 0===r?"https://ideality.app/api/polygon/":r,l=n.databaseId,f=void 0===l?"485b3bd6b4524c1dbd9ef2acc5bccfbf":l,m=n.openAIkey,h=void 0===m?e.env.OPENAI_KEY:m,v=n.defaultParameters,y=void 0===v?{}:v;return t=c.a.create({baseURL:o}),{run:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return console.log("Running",e,{variables:n,parameters:r}),t.post("/run",{databaseId:f,slug:e,openAIkey:h,variables:n,parameters:d(d({},y),r)}).then((function(e){return e.data}))}}}}).call(this,n(134))},439:function(e,t,n){"use strict";n(411)},440:function(e,t,n){var r=n(108)(!1);r.push([e.i,"label{font-weight:700}.footer{border-top:1px solid #e7e7e7}.footer,.header{background-color:#f7f7f7}.header{border-bottom:1px solid #e7e7e7}",""]),e.exports=r},443:function(e,t,n){"use strict";n.r(t);var r,o=n(35),c=n(34),l=n(33),d=(n(84),n(85),n(110),n(15),n(18),n(16),n(1),n(3),n(133),n(19),n(400),n(10),n(22),n(38),n(30),n(249),n(41),n(105),n(406)),f=n.n(d),m=(n(415),n(2),n(173),n(397));r=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[["createdAt","desc"]];return Object.assign(this,{items:e,root:{id:0},find:function(e){return f.a.find(this.items,{id:e})},getters:{parent:function(t){return e.find((function(i){return i.id===t.parentId}))||this.root},children:function(t){return f()(e).filter((function(e){return t?e.parentId===t.id:!e.parentId})).orderBy(n).value()},siblings:function(t){var r=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return f.a.orderBy(e.filter((function(e){return r.parent(e)===r.parent(t)&&(o||e!==t)}),n))},numSiblings:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.siblings(e,t).length},siblingIndex:function(e){return this.siblings(e).indexOf(e)},sibling:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(t=((t=this.siblingIndex(e))+n)%this.numSiblings(e);t<0;)t+=this.numSiblings(e);return this.siblings(e)[t]},nextSibling:function(e){return this.sibling(e,1)},prevSibling:function(e){return this.sibling(e,-1)},ancestors:function(e){return e.parentId?[this.parent(e)].concat(Object(l.a)(this.ancestors(this.parent(e)))):[]},lineage:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.includeSelf,o=void 0===r||r;return t=Object(l.a)(this.ancestors(e)).reverse(),o&&t.push(e),t[0]===this.root&&t.shift(),console.log({item:e,includeSelf:o,lineage:t}),t},heir:function(e){return Object(m.a)("Calculating heir for",e),this.children(e).length?this.heir(f.a.orderBy.apply(f.a,[this.children(e)].concat(Object(l.a)(n)))[0]):e},thread:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.lineage(t?this.heir(e):e)}},cache:{},createChild:function(t,n){return Object(m.a)({item:t},Object.assign(n,{parentId:null!=t?t.id:void 0,id:f()(e).map("id").max()+1||1,createdAt:new Date}))},clone:function(e){return this.createChild(this.parent(e),f.a.omit(e,"id","createdAt"))},delete:function(t){var n,r=this;return n=this.children(t),e.splice(e.indexOf(t),1),n.forEach((function(e){return r.delete(e)})),e}}),f.a.forEach(this.getters,(function(e,n){return t[n]=function(t){for(var path,r,o=arguments.length,c=new Array(o>1?o-1:0),l=1;l<o;l++)c[l-1]=arguments[l];return path=[null!=(r=null!=t?t.id:void 0)?r:"undefined",n,JSON.stringify(c)],f.a.has(this.cache,path)||f.a.set(this.cache,path,e.apply(this,[t].concat(c))),f.a.get(this.cache,path)}})),this};var h=r,v=n(0),y=n(40),x=(n(52),n(5),n(4),n(6),n(7),n(437));function k(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function w(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(t){Object(v.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var O,C={mounted:function(){var e;if(window.vm){for(e=1;window["vm".concat(e)];)e++;return window["vm".concat(e)]=this}return window.vm=this}},j=n(401),I={data:function(){return{window:null}},mounted:function(){return Object.assign(this,{window:window})}},_=n(438),S={mixins:[function(){var e,t,n,r,o,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=c.prefix,d=c.keys,f=c.format,m=void 0===f?"json":f;return"yaml"===m?(r=x.a.load,e=x.a.dump):(r=JSON.parse,e=JSON.stringify),n=!1,o=null,t=function(e){return l?"".concat(l,".").concat(e):e},{data:function(){return{localLoaded:new Promise((function(e){return o=e}))}},mounted:function(){var e=this;return d.forEach((function(n){var o,c,l,d,f;return f=localStorage.getItem(t(n)),o=e[n],console.log({key:n,localValue:f,defaultValue:o}),d="object"===Object(y.a)(o)&&null!==o,c=Array.isArray(o),l="number"==typeof o,f=d?r(f||null):l?parseFloat(f||null):f||null,e[n]=d&&!c?w(w({},o),f):f||o})),this.$nextTick((function(){return n=!0,o()}))},watch:w({},d.reduce((function(r,o){return Object.assign(r,Object(v.a)({},o,{deep:!0,handler:function(r){var c;if(n)return c=t(o),console.log("Syncing ".concat(o," to local storage key ").concat(c)),localStorage.setItem(c,"object"===Object(y.a)(r)?e(r):r)}}))}),{}))}}({keys:["user","messages","openAIkey","usdSpent","settings"],format:"yaml",prefix:"mindy"}),C,j.a,I],head:function(){return{title:this.routedMessage?"".concat(this.routedMessage.content," · Mindy"):"Mindy · Brainstorm with AI"}},data:function(){return{settings:{autoBuildContext:!0,numGenerations:3},input:"",lastMessageTime:null,sending:!1,generatingContext:!1,generatingReply:!1,enteredName:"",checkingName:!1,editing:{message:null,input:""},nameUnavailable:!1,user:{name:"you"},messages:[],openAIkey:null,routedMessage:null,typingCount:0,typingInterval:null,usdSpent:0,bot:{name:"mindy",isBot:!0},idsBySlug:null,previousThread:null}},computed:{tree:function(){return new h(this.messages)},thread:function(){var e;return this.routedMessage?(null!=(e=this.previousThread)?e.includes(this.routedMessage):void 0)?this.previousThread:this.previousThread=this.tree.thread(this.routedMessage||this.tree.root):[]},lastMessage:function(){return f.a.last(this.thread)},polygon:function(){return new _.a({openAIkey:this.openAIkey,defaultParameters:{max_tokens:300,n:this.settings.numGenerations}})}},mounted:function(){return this.openAIkey?this.$refs.input.focus():(console.log("OpenAI key not set; showing modal"),this.$refs.openAIkeyModal.show())},methods:{addMessage:function(e){return this.messages=[].concat(Object(l.a)(this.messages),[e]),e},edit:function(e){return this.editing.message=e,this.editing.input=e.content},sendMessage:function(){var e,t,n,r=this,input=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.input,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.a.last(this.thread)||this.tree.root,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return console.log({input:input,parent:o,retrying:l}),(l?this.tree.parent(o):o)!==this.tree.root&&(e=!0,t=this.tree.lineage(o,!l).map((function(e){var t=e.user.isBot,content=e.content;return"".concat(t?"Mindy":"User",":\n").concat(content)})).join("\n\n"),console.log({previousConversation:t})),n=e?"continued":"first",this.try("sending",(function(){var e;return l?e=o:(e=r.addMessage(r.tree.createChild(o,{user:r.user,content:input})),r.input="",r.routedMessage=e,r.$nextTick((function(){var e;return null!=(e=r.$refs.scrollToBottom)?e.scrollIntoView():void 0}))),console.log({message:e}),r.$nextTick((function(){return r.try("generatingReply",Object(c.a)(regeneratorRuntime.mark((function o(){var c,l,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.polygon.run(n,{input:input,previousConversation:t},{stop:"User:"});case 2:return d=o.sent,l=d.choices,c=d.approximateCost,r.usdSpent+=parseFloat(c),r.input="",console.log({message:e,choices:l}),l.forEach((function(t){var n,text=t.text;if(n=r.addMessage(r.tree.createChild(e,{user:r.bot,content:text})),console.log({reply:n}),r.settings.autoBuildContext)return r.$nextTick((function(){return r.generateContext(n)}))})),o.abrupt("return",r.$nextTick((function(){var e;return r.routedMessage=f.a.last(r.messages),null!=(e=r.$refs.scrollToBottom)&&e.scrollIntoView(),r.focusOnInput()})));case 10:case"end":return o.stop()}}),o)}))),{except:function(t){return console.error(t),r.messages=f.a.without(r.messages,e),input=e.content}})}))}))},focusOnInput:function(){return this.$nextTick((function(){var e;return(e=new MutationObserver((function(t){var n;if(n=t.find((function(e){var t=e.attributeName,n=e.target.disabled;return"disabled"===t&&!n})))return n.target.focus(),e.disconnect()}))).observe(document.querySelector("#input"),{attributes:!0})}))},getConversation:function(e){return f.a.isArray(e)||(e=this.tree.lineage(e,{includeSelf:!0})),e.map((function(e){var t=e.user.isBot,content=e.content;return"".concat(t?"Mindy":"User",":\n").concat(content)})).join("\n\n")},generateContext:function(e){var t=this;return this.try("generatingContext",Object(c.a)(regeneratorRuntime.mark((function n(){var r,c,l,d,h,v,y,x,k,w,text,O,C;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Object(m.a)("Generating context for",e),Object(m.a)("Previous message with context",k=f.a.findLast(t.tree.lineage(e,{includeSelf:!1}),(function(e){return e.context}))),w=(c=!!k)?"context-rebuild":"context",Object(m.a)({slug:w}),Object(m.a)("Conversation before ".concat(c?"previous context":"current message"),d=t.getConversation(k||e)),c&&(x=k.context,Object(m.a)("Messages after previous context",v=t.tree.lineage(e,{includeSelf:!0}).slice(t.tree.lineage(k,{includeSelf:!0}).length)),Object(m.a)("Conversation after previous context",l=t.getConversation(v))),n.next=9,t.polygon.run(w,{conversationBeforePreviousContext:d,previousContext:x,conversationAfterPreviousContext:l},{stop:"```"});case 9:return O=n.sent,C=Object(o.a)(O.choices,1),text=C[0].text,r=O.approximateCost,t.usdSpent+=parseFloat(r),h=function(line){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return(line.length-line.trimLeft().length)/e},y=function(e){var t,n;return t=(e=(e="function"==typeof e.replace?e.replace(/```[\s\S]*?/,""):void 0).trim()).trim().split("\n"),n=h(t[1],1),(t=t.map((function(line){var e;return e=h(line,n),line.replace(/^\s*/,"\t".repeat(e)).replace(/(^\s*)[-*•]\s*/,"$1")}))).join("\n")},n.abrupt("return",t.$set(e,"context",Object(m.a)("Post-processed context",y(text))));case 17:case"end":return n.stop()}}),n)}))))},cloneAndSend:function(){try{return this.sendMessage(this.editing.input,this.tree.parent(this.editing.message))}finally{this.editing.message=null}}},watch:{generatingReply:function(e){var t=this;return clearInterval(this.typingInterval),e?(this.$nextTick((function(){var e;return null!=(e=t.$refs.scrollToBottom)?e.scrollIntoView():void 0})),this.typingInterval=setInterval((function(){return t.typingCount=(t.typingCount+1)%3}),500)):this.typingCount=0},routedMessage:function(e){var t;if(e){if((t=e.id)===parseInt(this.$route.query.id))return;return Object(m.a)("Routing to message #".concat(t)),this.$router.push({query:{id:e.id}})}},"$route.query.id":{immediate:!0,handler:(O=Object(c.a)(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(m.a)("Navigating to message #".concat(t)),!t){e.next=14;break}return e.next=4,this.localLoaded;case 4:if("last"===t&&(r=f.a.last(this.messages),t=r.id),!(n=this.tree.find(parseInt(t)))){e.next=10;break}return e.abrupt("return",this.routedMessage=n);case 10:return Object(m.a)("Message #".concat(t," not found")),e.abrupt("return",this.routedMessage=null);case 12:e.next=15;break;case 14:return e.abrupt("return",this.routedMessage=null);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})}}},M=S,A=(n(439),n(68)),component=Object(A.a)(M,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",{staticClass:"p-5 vh-100",attrs:{fluid:""}},[n("b-row",{attrs:{"align-v":"center"}},[n("b-col",{staticClass:"p-0",staticStyle:{height:"calc(100vh - 200px)"}},[e.messages?[n("div",{staticClass:"header text-center border-top border-right border-left"},[n("h1",{staticClass:"mb-0 display-3",staticStyle:{"font-size":"3rem"}},[e._v("Mindy")]),n("p",{staticClass:"lead",staticStyle:{"font-size":"1rem"}},[e._v("Brainstorm with AI")])]),n("div",{staticClass:"border-right border-left",staticStyle:{height:"calc(100vh - 400px)","overflow-y":"scroll"},attrs:{id:"messages"}},[e._l(e.thread,(function(t,r){return n("div",{key:r,staticClass:"mt-2 p-2",style:{"background-color":r%2?"#f7f7f7":"#fff",border:t===e.routedMessage&&t!==e.lastMessage?"1px solid #ccc":"none",cursor:t!==e.routedMessage&&t.user.isBot?"pointer":"default"},on:{click:function(){t!==e.routedMessage&&t.user.isBot&&(e.routedMessage=t)}}},[t.special?[n("em",[n("strong",[e._v(e._s(t.user.name)+" "+e._s(t.content))])])]:e._e(),e.tree.numSiblings(t)>1?[n("div",{staticStyle:{"font-size":"0.8em",color:"#aaa",float:"right"}},[n("nuxt-link",{staticClass:"mr-1",staticStyle:{color:"inherit"},attrs:{to:{query:{id:e.tree.sibling(t,-1).id}}},domProps:{textContent:e._s("< "+(e.tree.siblingIndex(t)+1))}}),e._v("/"),n("nuxt-link",{staticClass:"ml-1",staticStyle:{color:"inherit"},attrs:{to:{query:{id:e.tree.sibling(t,1).id}}},domProps:{textContent:e._s(e.tree.numSiblings(t)+" >")}})],1)]:e._e(),t.user.name!==e.user.name||e.editing.message?e._e():[n("a",{class:{"mr-1":e.tree.numSiblings(t)>1},staticStyle:{"font-size":"0.8em",color:"#aaa",float:"right",cursor:"pointer"},domProps:{textContent:e._s("🖉")},on:{click:function(n){return e.edit(t)}}})],n("div",{class:{"text-primary":e.user&&t.user.name===e.user.name},style:{fontWeight:"bold"},domProps:{textContent:e._s(t.user.name)}}),e.editing.message!==t?n("div",{domProps:{innerHTML:e._s(e.$md.render(t.content))},on:{dblclick:function(n){return e.edit(t)}}}):n("div",[n("b-textarea",{attrs:{rows:"3","max-rows":"10"},on:{keydown:[function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")||n.ctrlKey||n.shiftKey||n.altKey||n.metaKey?null:(n.preventDefault(),function(){t.user.isBot||e.cloneAndSend()}.apply(null,arguments))},function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"]))return null;e.editing.message=null}]},model:{value:e.editing.input,callback:function(t){e.$set(e.editing,"input",t)},expression:"editing.input"}}),t.user.isBot?e._e():n("b-button",{staticClass:"m-1",attrs:{size:"sm",variant:"primary"},on:{click:e.cloneAndSend}},[e._v("Save & submit")]),n("b-button",{staticClass:"m-1",attrs:{size:"sm",variant:t.user.isBot?"primary":"outline-secondary"},on:{click:function(n){t.content=e.editing.input,e.editing.message=null}}},[e._v(e._s(t.user.isBot?"Save":"Just save"))]),n("b-button",{staticClass:"m-1",attrs:{variant:"outline-secondary",size:"sm"},on:{click:function(t){e.editing.message=null}}},[e._v("Cancel")]),n("b-button",{staticClass:"m-1",attrs:{variant:"outline-danger",size:"sm"},on:{click:function(n){e.window.confirm("Are you sure you want to delete this message and all of its further replies? THERE IS NO UNDO!")&&(e.messages=e.tree.delete(t),e.routedMessage=e.tree.parent(t),e.editing.message=null)}}},[e._v("Delete")])],1),t===e.routedMessage?[e.generatingReply?n("div",{staticClass:"p-2 text-muted"},[n("em",[e._v("mindy is thinking"+e._s(".".repeat(e.typingCount+1)))])]):e._e(),t.user.isBot?n("div",{staticClass:"p-2 text-center"},[n("b-button",{staticClass:"mx-1",attrs:{variant:"outline-secondary",disabled:e.sending||e.generatingReply},on:{click:function(n){e.sendMessage(e.tree.parent(t).content,e.tree.parent(t),!0)}}},[e._v("↺ Try again")])],1):e._e()]:e._e()],2)})),n("div",{ref:"scrollToBottom",staticClass:"mt-2"})],2),n("div",{staticClass:"footer p-2 border-bottom border-right border-left"},[e.user.name?e._e():[n("b-form-group",{attrs:{label:"Name","label-for":"username"}},[n("b-form-input",{attrs:{id:"username",value:e.enteredName,placeholder:"Enter your name to start chatting"},on:{input:function(t){e.enteredName=t.toLowerCase().replace(/[^a-z0-9-]+/g,"-").replace(/-+/g,"-")},change:function(t){e.user.name=e.enteredName}}})],1)],n("b-form",{staticClass:"mb-0",on:{submit:function(t){return t.preventDefault(),e.sendMessage()}}},[n("b-form-group",{attrs:{label:e.user&&e.user.name,"label-for":"input"}},[n("b-textarea",{ref:"input",attrs:{id:"input",placeholder:"Enter to send, Shift+Enter for new line",disabled:!e.user||e.sending||e.generatingReply},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),void(e.user&&e.input&&!e.sending&&!e.generatingReply&&e.sendMessage()))}},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}})],1),n("b-button",{attrs:{type:"submit",variant:e.sending?"outline-secondary":"primary",disabled:!e.input||e.sending||e.generatingReply}},[e._v(e._s(e.sending?"Sending...":"Send")),e.sending?n("b-spinner",{attrs:{small:""}}):e._e()],1)],1)],2)]:n("b-spinner")],2),n("b-col",{staticClass:"col-xl-8 col-lg-7 col-sm-6"},[n("b-row",{staticClass:"justify-content-center text-center"},[e.routedMessage?[n("MindyContext",{directives:[{name:"show",rawName:"v-show",value:!!e.routedMessage.context&&!e.generatingContext,expression:"!!routedMessage.context && !generatingContext"}],on:{rebuild:function(t){return e.generateContext(e.routedMessage)}},model:{value:e.routedMessage.context,callback:function(t){e.$set(e.routedMessage,"context",t)},expression:"routedMessage.context"}}),e.routedMessage.context?e._e():n("b-button",{staticClass:"mx-1",attrs:{disabled:e.sending||e.generatingReply||e.generatingContext,variant:e.generatingContext?"light":"outline-primary"},on:{click:function(t){return e.generateContext(e.routedMessage)}}},[e._v("丫 "+e._s(e.generatingContext?"Building mindmap...":e.generatingReply&&e.settings.autoBuildContext?"A little patience...":"Build mindmap"))])]:n("div",{staticClass:"lead"},[n("p",[e._v("Ask Mindy a question, and watch the magic unfold!")])])],2)],1)],1),n("OpenAIKeyModal",{ref:"openAIkeyModal",model:{value:e.openAIkey,callback:function(t){e.openAIkey=t},expression:"openAIkey"}}),n("div",{staticClass:"footer p-2 border-top border-right border-left fixed-bottom"},[n("div",{staticClass:"float-right text-right text-muted px-2",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$refs.openAIkeyModal.show()}}},[e._v(e._s(e.openAIkey?"🔑 sk-..."+e.openAIkey.slice(-4):"🔑 No OpenAI key"))]),n("div",{staticClass:"float-right text-right text-muted px-2",staticStyle:{cursor:"not-allowed"},on:{click:function(){e.window.confirm("Are you sure you want to clear the cost counter?")&&(e.usdSpent=0)}}},[e._v("💸 ~$"+e._s(parseFloat(e.usdSpent).toFixed(2)))]),n("span",{staticClass:"float-left text-right px-2",class:e.settings.autoBuildContext?"text-success":"text-muted",staticStyle:{cursor:"pointer"},on:{click:function(t){e.settings.autoBuildContext=!e.settings.autoBuildContext}}},[e._v("丫")]),n("span",{staticClass:"float-left text-right text-muted px-2",staticStyle:{cursor:"pointer"},on:{click:function(t){e.settings.numGenerations=e.settings.numGenerations%3+1}}},[e._v("💬 × "+e._s(e.settings.numGenerations))]),n("div",{staticClass:"float-left text-right text-muted px-2",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$bvModal.show("settings-modal")}}},[e._v("...")]),n("b-modal",{attrs:{id:"settings-modal",title:"Settings","hide-footer":"","hide-header":"",centered:""}},[n("EditSettings",{attrs:{properties:{autoBuildContext:{label:"Auto-build mindmap",description:{true:"Mindy will automatically build a mindmap whenever you navigate to a reply.",false:'You will have to click the "Mindmap" button to build a mindmap.'}},numGenerations:{label:"Number of replies at once",description:"How many replies to generate at once. Increasing this helps explore more options, but also costs more."}}},model:{value:e.settings,callback:function(t){e.settings=t},expression:"settings"}})],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{MindyContext:n(413).default,OpenAIKeyModal:n(414).default,EditSettings:n(399).default})}}]);